{"version":3,"sources":["../src/bridge/index.ts"],"sourcesContent":["import { MResponseStatusCode } from \"../types\";\r\nimport { MRequest } from \"../types/request\";\r\n\r\ninterface WebKitCallable {\r\n  postMessage: (data: string) => Promise<string>;\r\n}\r\ndeclare global {\r\n  interface Window {\r\n    webkit?: {\r\n      messageHandlers?: {\r\n        MinipNativeInteraction?: WebKitCallable;\r\n      };\r\n    };\r\n  }\r\n}\r\n\r\nlet jsBridge: {\r\n  callNative: <T>(req?: MRequest<T>) => Promise<any>;\r\n  callNativeSync: <T>(req?: MRequest<T>) => any;\r\n};\r\n\r\n// apple webkit\r\nif (window.webkit?.messageHandlers?.MinipNativeInteraction) {\r\n  const _callNative = window.webkit.messageHandlers.MinipNativeInteraction;\r\n  jsBridge = {\r\n    callNative(req) {\r\n      return _callNative\r\n        .postMessage(JSON.stringify(req))\r\n        .then((res) => JSON.parse(res))\r\n        .then((res) => {\r\n          if (res.code === MResponseStatusCode.SUCCESS) {\r\n            res.isSuccess = () => true;\r\n            const hashData = res.data !== null && res.data !== undefined;\r\n            res.hasData = () => hashData;\r\n            return res;\r\n          } else {\r\n            throw new Error(res.msg ?? \"Unknown error, res: \");\r\n          }\r\n        });\r\n    },\r\n    callNativeSync(req) {\r\n      const res = prompt(JSON.stringify(req));\r\n      if (res) {\r\n        const r = JSON.parse(res);\r\n\r\n        if (r.code === MResponseStatusCode.SUCCESS) {\r\n          r.isSuccess = () => true;\r\n          const hashData = r.data !== null && r.data !== undefined;\r\n          r.hasData = () => hashData;\r\n          return r;\r\n        } else {\r\n          throw new Error(r.msg ?? \"Unknown error, res: \");\r\n        }\r\n      }\r\n      throw new Error(\"Unknown error\");\r\n    },\r\n  };\r\n}\r\n// error\r\nelse {\r\n  jsBridge = {\r\n    callNative() {\r\n      return new Promise((_, reject) => {\r\n        reject(\"Cannot find JavaScript Bridge!!!\");\r\n      });\r\n    },\r\n    callNativeSync() {\r\n      return {\r\n        code: MResponseStatusCode.FAILED,\r\n        msg: \"Cannot find JavaScript Bridge!!!\",\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\nexport default jsBridge;\r\n"],"mappings":";AAgBA,IAAI;AAMJ,IAAI,OAAO,QAAQ,iBAAiB,wBAAwB;AAC1D,QAAM,cAAc,OAAO,OAAO,gBAAgB;AAClD,aAAW;AAAA,IACT,WAAW,KAAK;AACd,aAAO,YACJ,YAAY,KAAK,UAAU,GAAG,CAAC,EAC/B,KAAK,CAAC,QAAQ,KAAK,MAAM,GAAG,CAAC,EAC7B,KAAK,CAAC,QAAQ;AACb,YAAI,IAAI,0BAAsC;AAC5C,cAAI,YAAY,MAAM;AACtB,gBAAM,WAAW,IAAI,SAAS,QAAQ,IAAI,SAAS;AACnD,cAAI,UAAU,MAAM;AACpB,iBAAO;AAAA,QACT,OAAO;AACL,gBAAM,IAAI,MAAM,IAAI,OAAO,sBAAsB;AAAA,QACnD;AAAA,MACF,CAAC;AAAA,IACL;AAAA,IACA,eAAe,KAAK;AAClB,YAAM,MAAM,OAAO,KAAK,UAAU,GAAG,CAAC;AACtC,UAAI,KAAK;AACP,cAAM,IAAI,KAAK,MAAM,GAAG;AAExB,YAAI,EAAE,0BAAsC;AAC1C,YAAE,YAAY,MAAM;AACpB,gBAAM,WAAW,EAAE,SAAS,QAAQ,EAAE,SAAS;AAC/C,YAAE,UAAU,MAAM;AAClB,iBAAO;AAAA,QACT,OAAO;AACL,gBAAM,IAAI,MAAM,EAAE,OAAO,sBAAsB;AAAA,QACjD;AAAA,MACF;AACA,YAAM,IAAI,MAAM,eAAe;AAAA,IACjC;AAAA,EACF;AACF,OAEK;AACH,aAAW;AAAA,IACT,aAAa;AACX,aAAO,IAAI,QAAQ,CAAC,GAAG,WAAW;AAChC,eAAO,kCAAkC;AAAA,MAC3C,CAAC;AAAA,IACH;AAAA,IACA,iBAAiB;AACf,aAAO;AAAA,QACL;AAAA,QACA,KAAK;AAAA,MACP;AAAA,IACF;AAAA,EACF;AACF;AAEA,IAAO,iBAAQ;","names":[]}